# Run MongoDB as a service
services:
  mongodb:
    image: mongo:latest
    ports:
      - 27017:27017

steps:
- name: Checkout code
  uses: actions/checkout@v3

- name: Set up Python
  uses: actions/setup-python@v3
  with:
    python-version: '3.10'

- name: Install dependencies
  run: |
    python -m pip install --upgrade pip
    pip install fastapi uvicorn pytest requests pymongo

- name: Start FastAPI server
  run: |
    uvicorn apiserver:app --host 0.0.0.0 --port 8000 &
    sleep 5  # Wait for server to start

- name: Run tests
  env:
    MONGO_URI: mongodb://localhost:27017/
  run: |
    pytest test_automation.py
